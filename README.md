🍄 菇菇宅配網 - Pikmin Bloom 蘑菇報名系統 🍄
這是一個專為 Pikmin Bloom 玩家設計的蘑菇挑戰報名與管理平台，旨在提供一個中心化的介面，方便玩家發布、報名蘑菇挑戰，以及管理好友碼。系統採用了現代化的網頁技術棧，提供即時的資料更新、多角色權限管理與活動控管功能。

專案概述
本專案旨在解決遊戲中蘑菇挑戰協調的痛點，提供以下核心功能：

使用者認證與多角色權限管理：

支援四種使用者角色：報名者、發菇者 (僅發布)、發菇及報名者、管理者。

根據不同角色，提供精確的操作權限。

蘑菇挑戰發布與報名：

具權限的使用者可發布各種類型、名額、開放時間的蘑菇挑戰。

具權限的使用者可即時報名或取消報名；挑戰卡片會顯示參與者列表與報名時間。

每日限量報名機制：

管理者可在後台設定全域的「每人每日報名次數上限」。

系統會自動追蹤每位使用者當日的報名次數，並在額度用罄時限制其報名。

使用者的報名次數會由資料庫於每日固定時間自動重置歸零。

即時更新與響應式介面：

利用 Supabase Realtime 功能，確保挑戰列表、在線人數等資料即時同步。

前端介面經優化，在桌面與行動裝置上皆有良好的操作體驗，並採用漢堡選單收納次要功能。

管理後台：

管理者專用的介面，用於使用者管理（新增、重設密碼、修改角色、刪除）、挑戰管理（刪除）、每日報名上限設定。

即時監控資料庫連線狀態與使用者活躍度。

便利功能：

動態截圖：一鍵擷取當前可見的挑戰列表為圖片，方便分享。

好友碼聯絡簿：提供共享的平台，方便玩家管理與複製好友碼。

技術棧
前端:

HTML5 / CSS3 / JavaScript

Tailwind CSS: 快速建構響應式 UI 的 CSS 框架。

Supabase JS Client: 前端與 Supabase 後端服務互動的核心。

html2canvas: 用於實現將 HTML 元素轉換為圖片的功能。

後端 (Supabase):

PostgreSQL 資料庫: 儲存所有應用程式資料。

pg_cron: PostgreSQL 的排程工具，用於執行每日計數器歸零等定時任務。

Supabase Auth: 處理使用者註冊、登入與會話管理。

Supabase Edge Functions (Deno/TypeScript): 部署客製化後端邏輯，處理管理員的敏感操作。

Supabase Realtime: 提供資料庫變動的即時訂閱功能。

程式語言:

JavaScript (ES6+): 前端邏輯實現。

TypeScript: 用於 Supabase Edge Functions (index.ts)，提供型別安全。

SQL (PostgreSQL): 資料庫結構定義與資料庫函式 (RPC)。

功能詳情與實作細節
1. 權限與角色系統
系統定義了四種角色，其權限劃分如下：

報名者：僅能報名挑戰。

發菇者：僅能發布新挑戰，無法報名他人發布的挑戰。

發菇及報名者：可發布新挑戰，也可報名他人發布的挑戰。

管理者：擁有所有前台功能，並可進入管理後台進行使用者與系統管理。

2. 每日限量報名機制 (核心架構)
為實現此功能，系統採用了「後端排程」與「獨立計數器」的穩健架構。

資料庫層級：

daily_settings 資料表：用於儲存全域設定，目前包含一筆 setting_name 為 daily_signup_limit 的紀錄，其 setting_value 即為每日上限次數。管理者可在後台修改此值。

profiles 資料表：每個使用者對應的資料列中，有一個 daily_signup_count 欄位，用來獨立記錄該使用者當日已成功報名的次數。

後端自動化 (pg_cron)：

系統設定了一個名為 daily-signup-reset 的定時任務。

時區與時間：此任務基於 UTC 時間執行。設定為 0 16 * * *，意即在每日的 UTC 時間 16:00 執行，這對應到台灣標準時間 (UTC+8) 的每日凌晨 00:00。

執行內容：時間一到，任務會自動呼叫 reset_all_user_signup_counts() 這個資料庫函式，將 profiles 表中所有使用者的 daily_signup_count 欄位全部重設為 0。

操作邏輯 (RPC)：

使用者點擊報名時，前端呼叫 signup_for_challenge 函式。此函式會先檢查使用者的 daily_signup_count 是否已達上限，通過後才會執行報名，並將計數加一。

使用者取消報名時，cancel_signup_and_update_challenge 函式會將其 daily_signup_count 減一，實現額度返還。

前端顯示：

dashboard.html 頁面載入時，會從 daily_settings 讀取當前的上限值。

頁面頂部會顯示使用者個人的「本日額度：X / Y」。

每次報名或取消成功後，前端會重新從資料庫獲取最新的使用者資料，並即時更新此額度顯示。

當使用者額度用罄，所有「報名」按鈕都會自動變為灰色不可點擊的「報名額度已滿」狀態。

3. 前端頁面 (dashboard.html 等)
響應式設計：header 區塊經過重構，在桌面版顯示完整選單，在行動版則自動切換為漢堡選單，並將次要功能收納其中，以優化畫面空間。

狀態同步：所有功能（如報名、取消、額度顯示）在操作後都會觸發對應的資料刷新與介面重繪，確保使用者看到的是最新的即時狀態。

管理後台 (admin.html)：新增了「全域設定」區塊，讓管理者可以直接在此頁面修改每日報名上限，無需直接操作資料庫。

4. 後端函式 (index.ts)
安全性：所有管理員的敏感操作（使用者管理、挑戰刪除、全域設定讀寫）都統一由 admin-actions 這個 Edge Function 處理。

權限旁路：此函式內部使用 adminSupabaseClient（初始化時帶有 service_role 金鑰），因此在執行操作時可以繞過所有 RLS 策略，確保管理者指令的絕對執行權。

新增功能：為配合管理後台的新介面，index.ts 中已新增 get-daily-limit 和 set-daily-limit 兩個 case，專門處理每日上限的讀取與儲存。